> 如何证明线程共享内存？

使用一个共享变量就可以了

> 如何证明由单独的堆栈

使用递归函数，报告一个局部变量的地址，并且追踪地址的变化

发现栈	最大默认为8M

```cpp
int sum = 0;
void T_s()
{
    for(int i = 0; i < 3; ++i)
    {
        int t = load(sum);
        t += 1;
        store(sum ,t);
}
}
```

并发执行三个 sum最终最小是多少

sum最小是2 因为有个循环，直觉上你可能认为是1或者3，无论多少线程

编译器优化可能会隐藏并发问题



```cpp
while (!flag) // flag是一个全局变量 当其他线程结束后，flag会true
```

但是如果这是个顺序程序，编译器可能做什么优化

- 可能会只是读取flag一次，如果使用volatile，可以组织这种优化



处理器也是编译器

- 会预先取指令
- 如果在执行某个指令的时候，cache miss，并且发现后面的代码和这个指令关系不大，就会跳过这个指令，执行后面的指令

共享内存实际上可能是每个线程单独的内存副本，只是内存之间会同步。

或者可能有写缓冲

